<html>
<head>
<title>MachineInterpreter.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
MachineInterpreter.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span><span class="s1">org.sdu.dk.frhou18</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">org.sdu.dk.frhou18.metamodel.Machine</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">org.sdu.dk.frhou18.metamodel.State</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">org.sdu.dk.frhou18.metamodel.Transition</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">java.util.List</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.util.NoSuchElementException</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.util.stream.Collectors</span><span class="s0">;</span>

<span class="s0">public class </span><span class="s1">MachineInterpreter {</span>
	<span class="s1">Machine machine</span><span class="s0">;</span>

	<span class="s0">public void </span><span class="s1">run(Machine m) {</span>
		<span class="s0">this</span><span class="s1">.machine = m</span><span class="s0">;</span>
	<span class="s1">}</span>

	<span class="s0">public </span><span class="s1">State getCurrentState() {</span>
		<span class="s0">return </span><span class="s1">machine.currentState</span><span class="s0">;</span>
	<span class="s1">}</span>

	<span class="s0">public void </span><span class="s1">processEvent(String string) {</span>
		<span class="s1">List&lt;Transition&gt; transitions</span><span class="s0">;</span>
		<span class="s0">try </span><span class="s1">{</span>
			<span class="s1">transitions = machine.currentState.transitions.stream()</span>
					<span class="s1">.filter(transition -&gt; transition.getEvent().equals(string)).collect(Collectors.toList())</span><span class="s0">;</span>
		<span class="s1">}</span><span class="s0">catch </span><span class="s1">(NoSuchElementException e){</span>
			<span class="s0">return;</span>
		<span class="s1">}</span>
		<span class="s0">for </span><span class="s1">(var transition : transitions) {</span>
			<span class="s0">if </span><span class="s1">(transition.isConditional()) {</span>
				<span class="s1">var conditional = machine.integers.get(transition.conditionalVariableName)</span><span class="s0">;</span>
				<span class="s0">switch </span><span class="s1">(transition.conditional) {</span>
					<span class="s0">case </span><span class="s1">EQUAL:</span>
						<span class="s0">if </span><span class="s1">(conditional != transition.conditionalCompareValue) </span><span class="s0">continue;</span>
						<span class="s0">break;</span>
					<span class="s0">case </span><span class="s1">GREATER:</span>
						<span class="s0">if </span><span class="s1">(conditional &lt;= transition.conditionalCompareValue) </span><span class="s0">continue;</span>
						<span class="s0">break;</span>
					<span class="s0">case </span><span class="s1">LESS:</span>
						<span class="s0">if </span><span class="s1">(conditional &gt;= transition.conditionalCompareValue) </span><span class="s0">continue;</span>
						<span class="s0">break;</span>
					<span class="s0">default</span><span class="s1">:</span>
						<span class="s0">continue;</span>
				<span class="s1">}</span>
			<span class="s1">}</span>
			<span class="s0">if </span><span class="s1">(transition.hasSetOperation()) {</span>
				<span class="s1">machine.integers.put(transition.operandVariableName</span><span class="s0">, </span><span class="s1">transition.setIntOperationValue)</span><span class="s0">;</span>
			<span class="s1">} </span><span class="s0">else if </span><span class="s1">(transition.hasIncrementOperation()) {</span>
				<span class="s1">machine.integers.put(transition.operandVariableName</span><span class="s0">, </span><span class="s1">machine.integers.get(transition.operandVariableName) + </span><span class="s2">1</span><span class="s1">)</span><span class="s0">;</span>
			<span class="s1">} </span><span class="s0">else if </span><span class="s1">(transition.hasDecrementOperation()) {</span>
				<span class="s1">machine.integers.put(transition.operandVariableName</span><span class="s0">, </span><span class="s1">machine.integers.get(transition.operandVariableName) - </span><span class="s2">1</span><span class="s1">)</span><span class="s0">;</span>
			<span class="s1">}</span>

			<span class="s1">machine.currentState = machine.states.stream().filter(state -&gt; state.getName().equals(transition.targetState.getName())).findFirst().get()</span><span class="s0">;</span>
			<span class="s0">return;</span>
		<span class="s1">}</span>
	<span class="s1">}</span>

	<span class="s0">public int </span><span class="s1">getInteger(String string) {</span>
		<span class="s0">return </span><span class="s1">machine.integers.get(string)</span><span class="s0">;</span>
	<span class="s1">}</span>

<span class="s1">}</span>
</pre>
</body>
</html>